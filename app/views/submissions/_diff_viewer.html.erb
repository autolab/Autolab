<div id="diff-box">
  <% if @compareVersion %>
    <% old_title = "[Left] #{@compare_version_email} #{@displayFilename} (version #{@compareVersion[:version]})" %>
    <% new_title = "[Right] #{@current_version_email} #{@displayFilename} (version #{@currentVersion[:version]})" %>
    <% diff_header = "--- #{old_title}\n+++ #{new_title}\n" %>
    <% begin %>
      <% diff_str = Diffy::Diff.new(@prev_file_contents, @file_contents, include_diff_info: true).to_s(:text) %>
      <% diff_str = ([diff_header] + (diff_str.lines.slice(2..-1) || [])).join("") %>
      <% diff_str.gsub!("\\", "\\\\") %>

      <pre id="diff-viewer-contents" style="display: none;"><%= diff_str %></pre>
      <div id="diff-viewer"></div>
    <% rescue %>
      <ul class="collection">
        <li class="collection-item">
          Unable to generate a diff for this file.
        </li>
      </ul>
    <% end %>
  <% else %>
    <ul class="collection">
      <li class="collection-item">
        There is no previous version for this file.
      </li>
    </ul>
  <% end %>
</div>
