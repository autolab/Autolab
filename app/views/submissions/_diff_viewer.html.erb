<div id="diff-box">
  <% if @prevVersion %>
    <% title = "Diff with previous version of #{@displayFilename} (version #{@prevVersion[:version]})" %>
    <% diff_header = "--- #{title}\n+++ #{title}\n" %>
    <% begin %>
    <% diff_str = Diffy::Diff.new(@prev_file_contents, @file_contents, include_diff_info: true).to_s(:text) %>
    <% if diff_str.present? %>
      <% diff_str = [diff_header] + diff_str.lines.slice(2..-1) %>
      <% diff_str = diff_str.join("") %>
    <% else %>
      <% diff_str = diff_header %>
    <% end %>
    <% diff_str.gsub!("\\", "\\\\") %>

    <pre id="diff-viewer-contents" style="display: none;"><%= diff_str %></pre>
    <div id="diff-viewer"></div>
    <% rescue %>
    <span>Unable to generate diff.</span>
    <% end %>
  <% else %>
    <span>There is no previous version.</span>
  <% end %>
</div>
