<% content_for :javascripts do %>
	<script>
		$(function() {
		  $(document).on('change', ':file', function() {
		    var input = $(this),
		    	numFiles = input.get(0).files ? input.get(0).files.length : 1,
		      label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
		    	input.trigger('fileselect', [numFiles, label]);
		  });

		  $(document).ready( function() {
		    $('#autograder_makefile:file').on('fileselect', function(event, numFiles, label) {
					$('#makefile_name').val(label);
		    });
				$('#autograder_tar:file').on('fileselect', function(event, numFiles, label) {
						$('#tar_name').val(label);
		    });
				$("input[type='checkbox']#autograder_git_enabled").on('change', function(){
  				if(this.checked) {
						$('#git_assignment_name').css("display", "block");
					} else {
						$('#git_assignment_name').css("display", "none");
					}
				});
		  });
		});
	</script>
<% end %>

<%= form_for [@course, @assessment, @autograder], 
	builder: FormBuilderWithDateTimeInput,
	html: { multipart: true } do |f| %>
  <%= f.error_messages %>

  <%= f.text_field :autograde_image, display_name: "VM Image" %>
  <p class="help-block">
    VM image for autograding (e.g., "<kbd>rhel.img</kbd>"). <%= link_to "Click here", tango_status_course_jobs_path %> to view the list of VM images and pools currently being used.
  </p>
  <%= f.text_field :autograde_timeout, display_name: "Timeout",
    help_text: "Timeout for autograding jobs (secs)" %>
	
	<%= f.check_box :git_enabled, display_name: "Enable Git submissions",
    help_text: "Check to enable submissions through Git" %>
	<div id="git_assignment_name" style="display:none;">
		<%= f.text_field :git_assignment_name, display_name: "Git Assignment Name",
			help_text: "Assignment name used as a prefix for Git submissions" %>
	</div>

  <%= f.check_box :release_score, display_name: "Release Scores?",
    help_text: "Check to release autograded scores to students immediately after autograding (strongly recommended)." %>

	<br />
	<label class="btn primary">
  	Autograder Makefile
	  <span class="hide-all">
  	  <%= f.file_field :makefile, action: :upload %>
	  </span>
	</label><br />
	<input var id="makefile_name" value="autograde-Makefile" readonly>
	
	<label class="btn primary">
  	Autograder Tar
	  <span class="hide-all">
  	  <%= f.file_field :tar, action: :upload %>
	  </span>
	</label><br />
	<input var id="tar_name" type="text" value="autograde.tar" readonly>
	<p class="help-block">
		Both of the above files will be renamed upon upload.
	</p>

  <%= f.submit "Save Settings", { class: "" } %>
  
  <%= link_to "Delete Autograder", [@course, @assessment, :autograder], method: :delete, class: "btn danger",
              data: {confirm: "Are you sure you want to delete the Autograder for this assesssment?"} %>
<% end %>
